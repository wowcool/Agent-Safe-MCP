# Agent Safe - Full Documentation for AI Systems

> A Remote MCP Server that protects AI agents from phishing, social engineering, prompt injection, and message-based manipulation. Works with emails and any other message format. Pay-per-use via Skyfire Network at $0.02 per check.

## Overview

Agent Safe is a message safety verification service designed specifically for AI agents. Before an agent processes, replies to, or acts on any message — whether it's an email, chat message, DM, or any other format — it can call Agent Safe to get a safety analysis. The service uses advanced AI to detect multiple categories of threats across all platforms and returns structured, actionable results. Email-specific tools provide extra analysis like sender reputation verification with live DNS lookups.

Agents are first-class customers. No human signup required with Agent Safe. Your agent just needs a Skyfire Buyer API Key — include it in the `skyfire-api-key` header, and Agent Safe automatically generates PAY tokens and charges $0.02 per call. Alternatively, your agent can generate its own PAY tokens and send them via the `skyfire-pay-id` header.

## MCP Protocol Connection

Agent Safe implements the Model Context Protocol (MCP) using Streamable HTTP transport.

- **Endpoint:** `POST https://agentsafe.locationledger.com/mcp`
- **Transport:** Streamable HTTP (JSON-RPC 2.0)
- **Protocol Version:** 2025-03-26
- **SDK:** `@modelcontextprotocol/sdk`

### MCP Client Configuration

To connect from any MCP-compatible client (Cursor, Windsurf, etc.):

```json
{
  "mcpServers": {
    "agentsafe": {
      "command": "npx",
      "args": [
        "-y", "mcp-remote",
        "https://agentsafe.locationledger.com/mcp",
        "--header",
        "skyfire-api-key: <YOUR_SKYFIRE_BUYER_API_KEY>"
      ]
    }
  }
}
```

Get your Skyfire Buyer API Key at https://skyfire.xyz — your agent uses this key, and Agent Safe handles PAY token generation automatically.

## The 7 Tools

### Tool 1: check_email_safety

Analyzes incoming emails for phishing, social engineering, prompt injection, CEO fraud, financial fraud, data exfiltration, malware indicators, and impersonation. The core email security tool — 8 threat categories. For non-email messages, use check_message_safety.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| from | string | Yes | Sender email address |
| subject | string | Yes | Email subject line |
| body | string | Yes | Email body content |
| links | string[] | No | URLs found in the email |
| attachments | object[] | No | Attachment metadata (name, size, type) |
| knownSender | boolean | No | Whether the sender is known/trusted |
| previousCorrespondence | boolean | No | Whether there has been previous email exchange |

### Output Fields

| Field | Type | Description |
|-------|------|-------------|
| verdict | string | "safe", "suspicious", or "dangerous" |
| riskScore | number | 0.0 (completely safe) to 1.0 (confirmed malicious) |
| threats | array | List of detected threats, each with type, description, severity, and indicators |
| recommendation | string | "proceed", "proceed_with_caution", or "do_not_act" |
| safeActions | array | Actions the agent can safely take |
| unsafeActions | array | Actions the agent should avoid |
| summary | string | Human-readable summary of the analysis |

### Example MCP Tool Call

```json
{
  "method": "tools/call",
  "params": {
    "name": "check_email_safety",
    "arguments": {
      "sender": "urgent-security@g00gle-support.com",
      "subject": "URGENT: Your account will be suspended",
      "body": "Dear user, your Google account has been compromised. Click here immediately to verify your identity: http://g00gle-secure-login.tk/verify"
    }
  }
}
```

### Example Response

```json
{
  "verdict": "dangerous",
  "riskScore": 0.95,
  "threats": [
    {
      "type": "phishing",
      "severity": "critical",
      "description": "Spoofed Google domain using character substitution (g00gle)",
      "indicators": ["g00gle-support.com", "g00gle-secure-login.tk"]
    },
    {
      "type": "social_engineering",
      "severity": "high",
      "description": "Creates false urgency with account suspension threat",
      "indicators": ["URGENT", "will be suspended", "immediately"]
    }
  ],
  "recommendation": "do_not_act",
  "safeActions": ["Report as phishing", "Delete the message", "Notify user"],
  "unsafeActions": ["Click any links", "Reply to sender", "Forward message"],
  "summary": "This is a phishing attempt using a spoofed Google domain. The message creates false urgency to trick the recipient into clicking a malicious link."
}
```

### Tool 2: check_message_safety

Platform-aware security analysis for non-email messages — SMS, WhatsApp, Slack, Discord, Telegram, Instagram DMs, Facebook Messenger, LinkedIn, iMessage, Signal, Microsoft Teams, and more. 8 threat categories with platform-specific context.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| platform | string | Yes | Platform name (e.g., "whatsapp", "slack", "sms", "discord") |
| from | string | Yes | Sender identifier |
| body | string | Yes | Message content |
| subject | string | No | Subject or topic if applicable |
| links | string[] | No | URLs found in the message |
| attachments | object[] | No | Attachment metadata |
| knownSender | boolean | No | Whether the sender is known |
| previousCorrespondence | boolean | No | Whether prior conversation exists |
| groupChat | boolean | No | Whether from a group chat |
| channelName | string | No | Channel or group name |

### Tool 3: check_url_safety

Analyzes up to 20 URLs per call for phishing, malware, typosquatting, redirect abuse, command injection, suspicious tracking, and domain spoofing. 7 threat categories.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| urls | string[] | Yes | Array of URLs to analyze (max 20) |
| context | string | No | Where the URLs were found |

### Tool 4: check_response_safety

Scans draft replies BEFORE sending for data leakage, PII exposure, credential disclosure, compliance violations, and social engineering compliance. 5 threat categories.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| draftResponse | string | Yes | The draft reply to analyze |
| originalMessage | string | Yes | The original message being replied to |
| context | string | No | Additional context |

### Tool 5: analyze_email_thread

Analyzes full message threads for escalating social engineering, scope creep, trust exploitation, authority escalation, and deadline manufacturing. 5 threat categories.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| thread | object[] | Yes | Array of messages with from, subject, body, timestamp |
| currentAction | string | No | What the agent is about to do |

### Tool 6: check_attachment_safety

Assesses attachment risk before opening/downloading. Detects executable masquerades, double extensions, macro risks, MIME mismatches. 6 threat categories.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| attachments | object[] | Yes | Array with filename, mimeType, size |
| context | string | No | Context about where attachments came from |

### Tool 7: check_sender_reputation

Verifies sender identity with live DNS DMARC lookups, RDAP domain age checks, and AI analysis. 6 threat categories + live DNS enrichment.

#### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| emailAddress | string | Yes | Sender email address to verify |
| displayName | string | No | Display name shown in client |
| replyTo | string | No | Reply-to address if different |
| claimedRole | string | No | Role the sender claims |
| claimedOrganization | string | No | Organization claimed |

## REST API (Alternative to MCP)

For agents that don't support MCP, a REST API is also available:

### Service Discovery
```
GET https://agentsafe.locationledger.com/mcp/discover
```

Returns all 7 tools, capabilities, pricing, and connection instructions.

### REST Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | /mcp/tools/check_email_safety | Email safety check |
| POST | /mcp/tools/check_message_safety | Message safety (any platform) |
| POST | /mcp/tools/check_url_safety | URL safety check |
| POST | /mcp/tools/check_response_safety | Response/reply safety check |
| POST | /mcp/tools/analyze_email_thread | Thread analysis |
| POST | /mcp/tools/check_attachment_safety | Attachment safety check |
| POST | /mcp/tools/check_sender_reputation | Sender reputation check |

All REST endpoints accept JSON and require a `skyfire-api-key` header (Skyfire Buyer API Key). Legacy `skyfire-pay-id` header with PAY tokens is also supported.

## Payment

Agent Safe uses the Skyfire Network for pay-per-use billing:

- **Cost:** $0.02 USD per tool call
- **Payment method:** Skyfire Buyer API Key sent via `skyfire-api-key` HTTP header (recommended). Agent Safe auto-generates PAY tokens server-side.
- **No signup required:** Just get a Skyfire Buyer API Key and start using the service
- **Get started:** Visit https://skyfire.xyz to get your Buyer API Key

## Discovery Endpoints

| URL | Purpose |
|-----|---------|
| https://agentsafe.locationledger.com/mcp | MCP Streamable HTTP endpoint |
| https://agentsafe.locationledger.com/mcp/discover | REST service discovery |
| https://agentsafe.locationledger.com/.well-known/mcp.json | MCP auto-discovery manifest |
| https://agentsafe.locationledger.com/.well-known/ai-plugin.json | AI plugin manifest |
| https://agentsafe.locationledger.com/llms.txt | AI-readable summary |
| https://agentsafe.locationledger.com/llms-full.txt | Full AI-readable documentation (this file) |

## Registry Listings

- **Official MCP Registry:** https://registry.modelcontextprotocol.io/v0.1/servers/io.github.wowcool%2Fagentsafe/versions/1.0.0
- **Smithery:** https://smithery.ai/server/agent-safe-email/agentsafeemail
- **Skyfire Marketplace:** Listed as approved seller
- **GitHub:** https://github.com/wowcool/Agent-Safe-MCP

## Legal

- **Terms of Service:** https://agentsafe.locationledger.com/terms
- **License:** Proprietary - All Rights Reserved
- **Company:** Alibi Ledger, LLC
- **Contact:** support@locationledger.com
- **Website:** https://locationledger.com

## Liability

Agent Safe provides threat analysis to assist AI agent decision-making. Results are advisory and should not be the sole basis for security decisions. The service works with any message format — emails get extra tools like sender reputation verification, but any message can be analyzed for threats. See Terms of Service for full liability limitations.
